
<div class="card shadow-sm me-3 mb-4" style="width: 16rem; min-height: 420px;">
    <a href="@urlPelicula">
        <img src="@Pelicula.Poster" class="card-img-top" alt="poster" style="height: 300px; object-fit: cover;" />
    </a>
    <div class="card-body d-flex flex-column justify-content-between">
        <h5 class="card-title" style="min-height: 48px;">
            <a href="@urlPelicula" class="text-decoration-none text-dark">@Pelicula.Titulo</a>
        </h5>
        @if (!string.IsNullOrWhiteSpace(Pelicula.Resumen))
        {
            <p class="card-text resumen-truncado" style="font-size: 0.95rem; min-height: 48px; max-height: 48px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                @Pelicula.Resumen
            </p>
            @if (Pelicula.Resumen.Length > 90)
            {
                <a class="btn btn-link p-0" style="font-size:0.95rem;" href="@GetUrlPelicula()">Ver m√°s</a>
            }
        }
        <div class="mt-auto d-flex justify-content-between gap-2">
            <a class="btn btn-outline-primary btn-sm d-flex align-items-center gap-1" title="Editar" href="/peliculas/editar/@Pelicula.Id">
                <i class="bi bi-pencil-square"></i>
                <span class="d-none d-md-inline">Editar</span>
            </a>
            <button type="button" class="btn btn-outline-danger btn-sm d-flex align-items-center gap-1" title="Borrar" @onclick="@(() => EliminarPelicula.InvokeAsync(Pelicula))">
                <i class="bi bi-trash"></i>
                <span class="d-none d-md-inline">Borrar</span>
            </button>
        </div>
    </div>
</div>

@code{
    [Parameter]
    [EditorRequired]
    public Pelicula Pelicula {get; set;}= null!;

    [Parameter]
    public EventCallback<Pelicula> EliminarPelicula{get; set;}
    private string urlPelicula = string.Empty;

    // Eliminado MostrarModalResumen y JSInterop para el modal

    private string GetUrlPelicula()
    {
        var slug = Pelicula.Titulo?.Replace(" ", "-").ToLowerInvariant() ?? "";
        return $"/pelicula/{Pelicula.Id}/{slug}";
    }

    protected override void OnInitialized()
    {
        urlPelicula = $"pelicula/{Pelicula.Id}/{Pelicula.Titulo.Replace(" ","-")}";
    }
}
